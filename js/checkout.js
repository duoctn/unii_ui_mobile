let Checkout={processCheckout:function(){$(".btn_checkout").click(function(){Checkout.disableCheckout(),$(this).html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý đơn hàng'),$("#frm_checkout").submit()})},frmDiscount:function(){$("#form_discount").bootstrapValidator({excluded:":disabled",fields:{code:{validators:{notEmpty:{message:"Vui lòng nhập mã giảm giá"}}}}}).on("success.form.bv",function(t){t.preventDefault();let e=new FormData($("#form_discount")[0]);$.ajax({url:$("#form_discount").attr("action"),type:"POST",data:e,async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(t){1==t.error?bootbox.alert({size:"small",message:t.message}):(Checkout.getTotal(),$("#discount input[name=code]").prop("disabled",!0),$("#btn_discount_apply").hide(),$("#btn_discount_remove").show())},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},getTotal:function(){if("total_cart"==$("#total_view").val()){base_url}else{base_url}$.ajax({url:url_total,type:"GET",async:!1,cache:!1,contentType:!1,processData:!1,dataType:"html",success:function(t){$(".checkout #total").html(t),Checkout.enableCheckout()},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})},removeDiscount:function(){$(document).on("click","#btn_discount_remove",function(){$.ajax({url:base_url+"checkout/remove-discount.html",type:"GET",async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(t){$("#btn_discount_apply").show(),$("#btn_discount_remove").hide(),$("#discount input[name=code]").val("").prop("disabled",!1),Checkout.getTotal()},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},sendAddress:function(){$(".send_address").click(function(){let t=$(this).data("id");$.ajax({url:base_url+"checkout/shipping-address",type:"POST",data:{address_id:t,_token:_token},dataType:"json",success:function(t){0==t.error?window.location.href=t.redirect:Vnit.showBootbox(t.message)},error:function(t,e,n){$(".auto-result").hide(),console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},paymentOffice:function(){$("#frm_payment_office").bootstrapValidator({excluded:":disabled",fields:{agree:{validators:{notEmpty:{message:"Bạn phải đồng ý với Điều khoản & điều kiện"}}}}}).on("success.form.bv",function(t){t.preventDefault();let e=new FormData($("#frm_payment_office")[0]);Checkout.disableCheckout(),$("#frm_payment_office .btn_checkout").html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý đơn hàng'),$.ajax({url:$("#frm_payment_office").attr("action"),type:"POST",data:e,async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(t){0==t.error?window.location.href=t.redirect:(t.redirect&&(window.location.href=t.redirect),t.reload&&location.reload(),t.message&&(Vnit.showBootbox(t.message),$("#frm_payment_office .btn_checkout").html("Xác nhận đặt hàng"),Checkout.enableCheckout()))},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},paymentBanking:function(){$("#frm_payment_banking").bootstrapValidator({excluded:":disabled",fields:{agree:{validators:{notEmpty:{message:"Bạn phải đồng ý với Điều khoản & điều kiện"}}},bank:{validators:{notEmpty:{message:"Vui lòng chọn ngân hàng để thanh toán"}}}}}).on("success.form.bv",function(t){t.preventDefault();let e=new FormData($("#frm_payment_banking")[0]);Checkout.disableCheckout(),$("#frm_payment_banking .btn_checkout").html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý đơn hàng'),$.ajax({url:$("#frm_payment_banking").attr("action"),type:"POST",data:e,async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(t){if(0==t.error){if("00"===t.data_return.code)return window.vnpay?vnpay.open({width:480,height:600,url:t.data_return.data}):window.location.href=t.data_return.data,!1;Vnit.showBootbox(t.data_return.message)}else t.redirect&&(window.location.href=t.redirect),t.reload&&location.reload(),t.message&&(Vnit.showBootbox(t.message),$("#frm_payment_banking .btn_checkout").html("Xác nhận đặt hàng"),Checkout.enableCheckout())},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},paymentVisa:function(){$("#frm_payment_visa").bootstrapValidator({excluded:":disabled",fields:{agree:{validators:{notEmpty:{message:"Bạn phải đồng ý với Điều khoản & điều kiện"}}},bank:{validators:{notEmpty:{message:"Vui lòng chọn ngân hàng để thanh toán"}}}}}).on("success.form.bv",function(t){t.preventDefault();let e=new FormData($("#frm_payment_visa")[0]);Checkout.disableCheckout(),$("#frm_payment_visa .btn_checkout").html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý đơn hàng'),$.ajax({url:$("#frm_payment_visa").attr("action"),type:"POST",data:e,async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(t){if(0==t.error){if("00"===t.data_return.code)return window.vnpay?vnpay.open({width:480,height:600,url:t.data_return.data}):window.location.href=t.data_return.data,!1;Vnit.showBootbox(t.data_return.message)}else t.redirect&&(window.location.href=t.redirect),t.reload&&location.reload(),t.message&&(Vnit.showBootbox(t.message),$("#frm_payment_banking .btn_checkout").html("Xác nhận đặt hàng"),Checkout.enableCheckout())},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},paymentVnPay:function(){$("#frm_payment_vnpay").bootstrapValidator({excluded:":disabled",fields:{agree:{validators:{notEmpty:{message:"Bạn phải đồng ý với Điều khoản & điều kiện"}}}}}).on("success.form.bv",function(t){t.preventDefault();let e=new FormData($("#frm_payment_vnpay")[0]);Checkout.disableCheckout(),$("#frm_payment_vnpay .btn_checkout").html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý đơn hàng'),$.ajax({url:$("#frm_payment_vnpay").attr("action"),type:"POST",data:e,async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(t){if(0==t.error){if("00"===t.data_return.code)return window.vnpay?vnpay.open({width:480,height:600,url:t.data_return.data}):window.location.href=t.data_return.data,!1;Vnit.showBootbox(t.data_return.message)}else t.redirect&&(window.location.href=t.redirect),t.reload&&location.reload(),t.message&&(Vnit.showBootbox(t.message),$("#frm_payment_vnpay .btn_checkout").html("Xác nhận đặt hàng"),Checkout.enableCheckout())},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},choiceBank:function(){$("#frm_payment_banking .bank-list .bank").click(function(){let t=$(this).data("id"),e=$(this).data("name");$("#frm_payment_banking .bank-list .bank").removeClass("active"),$(this).addClass("active"),$("#frm_payment_banking #bank_name").text(e),$("#frm_payment_banking input[name='bank']").val(t),$("#frm_payment_banking").data("bootstrapValidator").revalidateField("bank")})},choiceVisa:function(){$("#frm_payment_visa .bank-list .bank").click(function(){let t=$(this).data("id"),e=$(this).data("name");$("#frm_payment_visa .bank-list .bank").removeClass("active"),$(this).addClass("active"),$("#frm_payment_visa #bank_name").text(e),$("#frm_payment_visa input[name='bank']").val(t),$("#frm_payment_visa").data("bootstrapValidator").revalidateField("bank")})},sendShippingMethod:function(t){$.ajax({url:base_url+"checkout/shipping.html",type:"POST",data:{shipping_method_id:t,_token:_token},dataType:"json",success:function(t){Checkout.getTotal()},error:function(t,e,n){$(".auto-result").hide(),console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})},shipping_method:function(){$(".itemShippingService ").click(function(){let t=$(this).data("id"),e=$(this).data("name");$(".itemShippingService").removeClass("active"),$(this).addClass("active"),$(".method-choice span").text(e),shipping_method_id=t,Checkout.sendShippingMethod(shipping_method_id),Checkout.disableCheckout()})},disableCheckout:function(){$(".btn_checkout").each(function(){$(this).prop("disabled",!0)})},enableCheckout:function(){$(".btn_checkout").each(function(){$(this).prop("disabled",!1)})},getInsurance:function(){$("#insurance_fee").click(function(){let t=$(this).is(":checked")?1:0;$.ajax({url:base_url+"checkout/insurance",type:"POST",data:{insurance:t,_token:_token},dataType:"json",success:function(t){Object.keys(t.totals).forEach(function(e){$("#total_"+e).html(t.totals[e])})},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},actionCart:function(){$("body").on("click",".del_cart",function(){let t=$(this).data("id");return bootbox.confirm({size:"small",message:"Bán có muốn xóa sản phẩm này khỏi giỏ hàng?",buttons:{confirm:{label:"Có",className:"btn-success"},cancel:{label:"Không",className:"btn-danger"}},callback:function(e){e&&Cart.removeItem(t)}}),!1}),$("body").on("click",".btn-number",function(t){t.preventDefault();let e=$(this).attr("data-id"),n=$(this).attr("data-type"),a=$("input#qty_"+e),o=parseInt(a.val()),s=0;isNaN(o)?a.val(0):("minus"==n?(o>a.attr("min")&&a.val(o-1).change(),parseInt(a.val())==a.attr("min")&&$(this).prop("disabled",!0)):"plus"==n&&(o<a.attr("max")&&a.val(o+1).change(),parseInt(o+1)>a.attr("max")&&($(this).prop("disabled",!0),Vnit.showBootbox("Sản phẩm này không đủ số lượng theo yêu cầu của bạn"),s++),parseInt($("input#qty_"+e).val())>1&&$("#minus_"+e).prop("disabled",!1)),0==s&&Checkout.updateCart(e,parseInt($("input#qty_"+e).val())))}),$("body").on("change",".input-number",function(){let t=parseInt($(this).attr("min")),e=parseInt($(this).attr("max")),n=parseInt($(this).val()),a=parseInt($(this).data("old")),o=$(this).data("id"),s=0;n>=t?$("#minus_"+o).prop("disabled",!1):(Vnit.showBootbox("Xin lỗi. Sản phẩm này phải đặt tối thiểu  = 1"),$(this).val(a),s++),n<=e?$("#plus_"+o).prop("disabled",!1):(Vnit.showBootbox("Sản phẩm này không đủ số lượng theo yêu cầu của bạn"),$(this).val(a),s++),0==s&&Checkout.updateCart(o,n)}),$(".input-number").keydown(function(t){-1!==$.inArray(t.keyCode,[46,8,9,27,13,190])||65==t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode}),$("body").on("click",".agree",function(){let t=$(this).data("form");$("#"+t+" .agree").prop("checked",!1),$("#myModal_terms_conditions").modal("show"),$("#myModal_terms_conditions button").attr("data-form",t)})},updateCart:function(t,e){$.ajax({url:base_url+"checkout/update",type:"post",data:"_token="+_token+"&id="+t+"&qty="+e,dataType:"json",success:function(t){location.reload()},error:function(t,e,n){console.log(n+"\r\n"+t.statusText+"\r\n"+t.responseText)}})}},form_ele_btn="frm_payment_banking";$(document).ready(function(){Checkout.shipping_method(),Checkout.sendAddress(),Checkout.getInsurance(),Checkout.actionCart(),Checkout.frmDiscount(),Checkout.removeDiscount(),Checkout.paymentVisa(),Checkout.choiceVisa(),Checkout.paymentVnPay(),Checkout.paymentBanking(),Checkout.choiceBank(),Checkout.processCheckout()}),$(document).on("click","#myModal_terms_conditions #check_ok",function(){$("#"+form_ele_btn+" .agree").prop("checked",!0),$("#myModal_terms_conditions").modal("hide"),$("#"+form_ele_btn).data("bootstrapValidator").revalidateField("agree"),console.log("2:"+form_ele_btn)});