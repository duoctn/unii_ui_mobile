var buyNow={shipping_method:function(){$(document).on("click","#buynow .itemShippingService",function(){var n=$(this).data("id"),t=$(this).data("name");$("#buynow .itemShippingService").removeClass("active"),$(this).addClass("active"),$(".method-choice span").text(t),shipping_method_id=n,buyNow.sendShippingMethod(shipping_method_id),buyNow.disableCheckout()})},sendShippingMethod:function(n){$.ajax({url:base_url+"buy-now/save-shipping",type:"POST",data:{shipping_method_id:n,code:product_code,_token:_token},dataType:"json",success:function(n){buyNow.getTotal()},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})},getTotal:function(){$.ajax({url:base_url+"buy-now/total",type:"POST",data:{_token:_token,code:product_code},dataType:"json",success:function(n){$("#buynow #total").html(n.html),buyNow.enableCheckout()},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})},choiceBank:function(){$("#frm_buy_now #payment_atm .bank-list .bank").click(function(){var n=$(this).data("id"),t=$(this).data("name");$("#frm_buy_now #payment_atm .bank-list .bank").removeClass("active"),$(this).addClass("active"),$("#frm_buy_now #payment_atm #bank_name").text(t),$("#frm_buy_now input[name='bank']").val(n)})},choiceVisa:function(){$("#frm_buy_now #payment_visa .bank-list .bank").click(function(){var n=$(this).data("id"),t=$(this).data("name");$("#frm_buy_now #payment_visa .bank-list .bank").removeClass("active"),$(this).addClass("active"),$("#frm_buy_now #payment_visa #bank_name").text(t),$("#frm_buy_now input[name='bank']").val(n)})},postShipping:function(){var n=$("#buynow select[name='shipping_city_id']").val(),t=$("#buynow select[name='shipping_district_id']").val(),e=$("#buynow select[name='shipping_ward_id']").val(),o={code:product_code,_token:_token,city_id:n,district_id:t,ward_id:e};$.ajax({url:base_url+"checkout/shipping-address-buy-now",type:"post",dataType:"json",data:o,success:function(n){buyNow.getShipping(),buyNow.getTotal()},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})},getShipping:function(){$.ajax({url:base_url+"buy-now/shipping",type:"post",dataType:"json",data:{_token:_token,code:product_code},success:function(n){$("#buynow #shipping_method").html(n.html)},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})},submitData:function(n){$.ajax({url:$("#frm_buy_now").attr("action"),type:"POST",data:n,async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(n){if(0==n.error){if(n.redirect&&(window.location.href=n.redirect),"00"===n.data_return.code)return window.vnpay?vnpay.open({width:480,height:600,url:n.data_return.data}):window.location.href=n.data_return.data,!1;Vnit.showBootbox(n.data_return.message)}else n.redirect&&(window.location.href=n.redirect),n.message&&(Vnit.showBootbox(n.message),$("#frm_buy_now .btn_checkout").html("Xác nhận đặt hàng"),buyNow.enableCheckout())},error:function(n,t,e){buyNow.enableCheckout(),console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})},disableCheckout:function(){$("#buynow .btn_checkout").each(function(){$(this).prop("disabled",!0)})},enableCheckout:function(){$("#buynow .btn_checkout").each(function(){$(this).prop("disabled",!1)})},checkDiscount:function(){$("#btn_discount_apply").click(function(){""==$("#discount_code").val()?Vnit.showBootbox("Vui lòng nhập mã giảm giá"):$.ajax({url:base_url+"buy-now/discount",type:"POST",data:{_token:_token,code:$("#discount_code").val(),product_code:product_code},dataType:"json",success:function(n){1==n.error?bootbox.alert({size:"small",message:n.message}):(buyNow.getTotal(),$("#frm_buy_now #discount_code").prop("disabled",!0),$("#btn_discount_apply").hide(),$("#btn_discount_remove").show())},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})})},removeDiscount:function(){$(document).on("click","#btn_discount_remove",function(){$.ajax({url:base_url+"buy-now/remove-discount",type:"POST",data:{_token:_token,product_code:product_code},dataType:"json",success:function(n){$("#btn_discount_apply").show(),$("#btn_discount_remove").hide(),$("#frm_buy_now #discount_code").prop("disabled",!1),buyNow.getTotal()},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})})},getInsurance:function(){$("body").on("click","#insurance_fee",function(){var n=$(this).is(":checked")?1:0;$.ajax({url:base_url+"buynow/insurance",type:"POST",data:{insurance:n,_token:_token,code:product_code},dataType:"json",success:function(){window.location.reload()},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})})},init:function(){buyNow.getInsurance(),buyNow.postShipping(),buyNow.shipping_method(),$("#buynow .agree").click(function(){$("#buynow .agree").prop("checked",!1),$("#myModal_terms_conditions").modal("show")}),$(document).on("click","#myModal_terms_conditions #check_ok",function(){$("#buynow .agree").prop("checked",!0),$("#myModal_terms_conditions").modal("hide"),$("#frm_buy_now").data("bootstrapValidator").revalidateField("agree")}),$("#frm_buy_now input[name='payment_method']").click(function(){$("#frm_buy_now .tab-pane").removeClass("active"),$("#pane-"+$(this).val()).addClass("active"),$(".form-submit").addClass("active"),"vnpay"==$(this).val()?$("#frm_buy_now input[name='bank']").val("VNPAYQR"):($("#frm_buy_now input[name='bank']").val(""),$(".bank-list .bank").removeClass("active"),"visa"==$(this).val()?$("#payment_visa #bank_name").text("Vui lòng chọn loại thẻ"):"banking"==$(this).val()&&$("#payment_atm #bank_name").text("Vui lòng chọn ngân hàng để thanh toán"))})}};$(document).ready(function(){buyNow.init();var n=["fullname","phone","address","email"],t=["city_id","district_id","ward_id"],e=$("#payment_same_shipping").is(":checked");$("#buynow #payment_same_shipping").change(function(){(e=$("#payment_same_shipping").is(":checked"))?(n.forEach(function(n){$("#buynow input[name='shipping_"+n+"']").prop("disabled",!0),$("#buynow input[name='shipping_"+n+"']").val($("#buynow input[name='payment_"+n+"']").val())}),t.forEach(function(n){$("#buynow select[name='shipping_"+n+"']").prop("disabled",!0),$("#buynow select[name='shipping_"+n+"']").html($("#buynow select[name='payment_"+n+"']").html()),$("#buynow select[name='shipping_"+n+"']").val($("#buynow select[name='payment_"+n+"']").val()),buyNow.postShipping()})):(n.forEach(function(n){$("#buynow input[name='shipping_"+n+"']").prop("disabled",!1)}),t.forEach(function(n){$("#buynow select[name='shipping_"+n+"']").prop("disabled",!1),buyNow.postShipping()}))}),n.forEach(function(n){$("#buynow input[name='payment_"+n+"']").keyup(function(){e&&($("#buynow input[name='shipping_"+n+"']").val($("#buynow input[name='payment_"+n+"']").val()),$("#frm_buy_now").data("bootstrapValidator").revalidateField("shipping_"+n))})}),t.forEach(function(n){$("#buynow select[name='shipping_"+n+"']").change(function(){$("#frm_buy_now").data("bootstrapValidator").revalidateField("shipping_"+n),buyNow.postShipping()}),$("#buynow select[name='payment_"+n+"']").change(function(){e&&buyNow.postShipping()})}),$("#buynow .city_id").change(function(){var n=$(this).data("type");e&&$("select[name='shipping_city_id']").val($(this).val()),$.ajax({url:base_url+"customer/address/get-ajax?field=country&id="+$(this).val(),type:"get",dataType:"json",success:function(t){$('#buynow select[name="'+n+'_district_id"]').html(t.html),$('#buynow select[name="'+n+'_ward_id"]').html('<option value="">Chọn Phường xã</option>'),e&&($('#buynow select[name="shipping_district_id"]').html(t.html),$('#buynow select[name="shipping_ward_id"]').html('<option value="">Chọn Phường xã</option>'))},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})}),$("#buynow .district_id").change(function(){var n=$(this).data("type");e&&$("#buynow select[name='shipping_district_id']").val($(this).val()),$.ajax({url:base_url+"customer/address/get-ajax?field=district&id="+$(this).val(),type:"get",dataType:"json",success:function(t){$('select[name="'+n+'_ward_id"]').html(t.html),e&&$('select[name="shipping_ward_id"]').html(t.html)},error:function(n,t,e){console.log(e+"\r\n"+n.statusText+"\r\n"+n.responseText)}})}),$("#buynow .ward_id").change(function(){e&&$("select[name='shipping_ward_id']").val($(this).val())})});