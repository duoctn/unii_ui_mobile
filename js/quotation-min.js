var Quotation={frmOneLink:function(){$("#frm_send_link").bootstrapValidator({excluded:":disabled",fields:{product_link:{validators:{notEmpty:{message:"Vui lòng nhập link chi tiết sản phẩm"},uri:{allowLocal:!0,message:"Vui lòng nhập đầy đủ link bao gồm http://"}}},color:{},size:{}}}).on("success.form.bv",function(t){t.preventDefault();var n=$(t.target),o=new FormData($("#frm_send_link")[0]),e=$("#frm_send_link input[name='product_link']").val(),a=0;$("#productList tr").each(function(){$(this).data("url")==e&&(console.log($(this).data("url")),a++)}),0==a?($("#frm_send_link #submit_link").html($("#frm_send_link #submit_link").data("loading-text")),$.ajax({url:$("#frm_send_link").attr("action"),type:"POST",data:o,async:!1,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(t){0==t.error&&(t.redirect&&(window.location.href=t.redirect),Quotation.builtHtml(t.product),$("#form_product_list").show(),$(".qty").priceFormat({prefix:"",centsLimit:0,centsSeparator:"",thousandsSeparator:"",clearOnEmpty:!0}),$("#frm_send_link #submit_link").html($("#frm_send_link #submit_link").data("text")),n.bootstrapValidator("disableSubmitButtons",!1).bootstrapValidator("resetForm",!0)),Quotation.btnDisable()},error:function(t,n,o){console.log(o+"\r\n"+t.statusText+"\r\n"+t.responseText)}})):n.bootstrapValidator("disableSubmitButtons",!1).bootstrapValidator("resetForm",!0)})},remove_link:function(){$(document).on("click",".remove_link",function(){var t=$(this).parents("tr"),n=t.data("url");bootbox.confirm({size:"small",message:"Bạn có muốn xóa sản phẩm này không?",callback:function(o){$.ajax({url:base_url+"quotation/remove-link.html",type:"POST",data:{_token:_token,link:n},dataType:"json",success:function(n){0==n.error&&(t.remove(),Vnit.showNotify("",n.message),0==n.total&&$("#form_product_list").hide()),Quotation.btnDisable()},error:function(t,n,o){console.log(o+"\r\n"+t.statusText+"\r\n"+t.responseText)}})}})})},frmSendData:function(){$("body").on("change",'select[name="city_id"]',function(){$.ajax({url:base_url+"customer/address/get-ajax?field=country&id="+$(this).val(),type:"get",dataType:"json",success:function(t){$('select[name="district_id"]').html(t.html),$('select[name="ward_id"]').html('<option value="">Chọn Phường xã</option>')},error:function(t,n,o){console.log(o+"\r\n"+t.statusText+"\r\n"+t.responseText)}})}),$("body").on("change",'select[name="district_id"]',function(){$.ajax({url:base_url+"customer/address/get-ajax?field=district&id="+$(this).val(),type:"get",dataType:"json",success:function(t){$('select[name="ward_id"]').html(t.html)},error:function(t,n,o){console.log(o+"\r\n"+t.statusText+"\r\n"+t.responseText)}})})},builtHtml:function(t){var n='<tr data-url="'+t.product_link+'">';n+="<td>",n+='<div class="product-name"><a href="'+t.product_link+'" target="_blank">'+t.product_link+'</a><input type="hidden" name="link[]" value="'+t.product_link+'"></div>',n+='<div class="row">',n+='<div class="col-xs-4">Màu sắc: <input type="text" class="form-control" name="color[]" value="'+t.color+'"></div>',n+='<div class="col-xs-4">Kích cỡ: <input type="text" class="form-control" name="size[]" value="'+t.size+'"></div>',n+='<div class="col-xs-4">Số lượng: <input type="text" class="form-control qty" name="qty[]" value="'+t.qty+'"></div>',n+="</div>",n+="</td>",n+='<td><a href="javascript:;" class="remove_link"><i class="fa fa-trash-o"></i></a></td>',n+="</tr>",$("#productList").append(n),Quotation.setAutoWidth()},setAutoWidth:function(){$(".product-name").css({width:$(window).width()-80})},Init:function(){Quotation.setAutoWidth(),Quotation.frmOneLink(),Quotation.remove_link(),Quotation.frmSendData()}};function activaTab(t){$('.nav-tabs a[href="#'+t+'"]').tab("show")}$(document).ready(function(){Quotation.Init(),$(".qty").priceFormat({prefix:"",centsLimit:0,centsSeparator:"",thousandsSeparator:"",clearOnEmpty:!0})});